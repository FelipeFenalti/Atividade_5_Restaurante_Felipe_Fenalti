DELIMITER $
CREATE PROCEDURE horario_demissao() BEGIN

DECLARE data_demissao, dt_nasc DATE;
DECLARE cd_funcionario int;

DECLARE C_DEMISSAO CURSOR FOR SELECT cod_funcionario , dt_nascimento, dt_fim FROM funcionario;
OPEN C_DEMISSAO;

LOOP
  FETCH C_DEMISSAO INTO cd_funcionario, dt_nasc, data_demissao;

  IF (STR_TO_DATE('18/04/2022', '%d/%m/%Y') - dt_nasc)/365 > 80 THEN 
    UPDATE funcionario SET dt_fim = STR_TO_DATE('18/04/2022', '%d/%m/%Y')
    WHERE cod_funcionario = cd_funcionario;
  END IF;
END LOOP;
CLOSE C_DEMISSAO;
END
